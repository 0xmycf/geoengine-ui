<geoengine-sidenav-header>Calculate Expression on Raster</geoengine-sidenav-header>

<form [formGroup]="form" (ngSubmit)="add()" *ngIf="projectHasRasterLayers$ | async; else noDataInfo">
    <geoengine-operator-dialog-container [loading]="loading$ | async | valueDefault : false">
        <a mat-icon-button operatorInputIcon href="https://docs.geoengine.io/operators/expression.html" target="_blank">
            <mat-icon>help_center</mat-icon>
        </a>

        <ng-container operatorInput>
            <geoengine-multi-layer-selection
                [types]="RASTER_TYPE"
                formControlName="rasterLayers"
                [min]="3"
                [max]="3"
            ></geoengine-multi-layer-selection>
        </ng-container>

        <a mat-icon-button operatorParametersIcon href="https://docs.geoengine.io/operators/expression.html" target="_blank">
            <mat-icon>help_center</mat-icon>
        </a>

        <ng-container operatorParameters>
            <!-- <button type="button" mat-raised-button [disabled]="notAllLayersSet$ | async" (click)="retrieveRasterStatsFromUnit()">
                Set channel min/max values from metadata
            </button>
            <br />
            <button
                type="button"
                mat-raised-button
                [disabled]="notAllLayersSet$ | async"
                *ngIf="!(isRasterStatsLoading$ | async); else rasterStatsLoadingAnimation"
                (click)="calculateRasterStats()"
            >
                Calculate channel min/max values
            </button> -->
            <!-- <ng-template #rasterStatsLoadingAnimation>
                <mat-spinner [diameter]="loadingSpinnerDiameter"></mat-spinner>
            </ng-template> -->
            <h3>Red Channel (A)</h3>
            <div formGroupName="red">
                <mat-form-field>
                    <input matInput type="number" placeholder="Min" formControlName="min" />
                </mat-form-field>
                <mat-form-field>
                    <input matInput type="number" placeholder="Max" formControlName="max" />
                </mat-form-field>
                <mat-form-field>
                    <input matInput type="number" placeholder="Scaling Factor" formControlName="scale" min="0" max="1" step="0.1" />
                </mat-form-field>
            </div>
            <h3>Green Channel (B)</h3>
            <div formGroupName="green">
                <mat-form-field>
                    <input matInput type="number" placeholder="Min" formControlName="min" />
                </mat-form-field>
                <mat-form-field>
                    <input matInput type="number" placeholder="Max" formControlName="max" />
                </mat-form-field>
                <mat-form-field>
                    <input matInput type="number" placeholder="Scaling Factor" formControlName="scale" min="0" max="1" step="0.1" />
                </mat-form-field>
            </div>
            <h3>Blue Channel (C)</h3>
            <div formGroupName="blue">
                <mat-form-field>
                    <input matInput type="number" placeholder="Min" formControlName="min" />
                </mat-form-field>
                <mat-form-field>
                    <input matInput type="number" placeholder="Max" formControlName="max" />
                </mat-form-field>
                <mat-form-field>
                    <input matInput type="number" placeholder="Scaling Factor" formControlName="scale" min="0" max="1" step="0.1" />
                </mat-form-field>
            </div>
        </ng-container>

        <ng-container layerSpecification>
            <geoengine-operator-output-name formControlName="name">
                <mat-error *ngIf="form.controls.name.errors?.required || form.controls.name.errors?.onlyWhitespace">
                    The name must be non-empty.
                </mat-error>
            </geoengine-operator-output-name>
        </ng-container>

        <ng-container actions>
            <button type="submit" mat-raised-button color="primary" [disabled]="form.invalid || (loading$ | async)">Create</button>
        </ng-container>
    </geoengine-operator-dialog-container>
</form>

<ng-template #noDataInfo>
    <p class="no-rasters">
        no raster input available
        <br />
        <button mat-button *ngIf="dataListConfig" (click)="goToAddDataTab()">⇢ add some data ⇢</button>
    </p>
</ng-template>
