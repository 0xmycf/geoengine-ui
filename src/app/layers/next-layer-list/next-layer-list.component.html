<div class="container">
    <md-menu #layerListMenu="mdMenu">
        <button md-menu-item aria-label="Toggle Layer List Visibility"
                (click)="layoutService.toggleLayerListVisibility()"
                [ngSwitch]="layerListVisibility$ | async">
            <md-icon *ngSwitchCase="true">expand_less</md-icon>
            <md-icon *ngSwitchCase="false">expand_more</md-icon>
            <span>Show/Hide Layerlist</span>
        </button>
        <button md-menu-item (click)="dialog.open(LineageGraphComponent)">
            <md-icon>merge_type</md-icon>
            <span>Lineage</span>
        </button>
        <!--
        <button md-menu-item [disabled]="true">
            <md-icon>fullscreen</md-icon>
            <span>Zoom to All</span>
        </button>
        -->
        <button md-menu-item (click)="layerService.removeAllLayers()">
            <md-icon>delete_sweep</md-icon>
            <span>Remove All Layers</span>
        </button>
    </md-menu>

    <md-toolbar color="primary">
        <md-toolbar-row fxFlex fxLayout="row" fxLayoutAlign="space-between center">
            <div></div>
            <div class="logo"><md-icon md-list-icon svgIcon="vat:logo" alt="VAT"></md-icon> VAT</div>

            <button md-icon-button [mdMenuTriggerFor]="layerListMenu">
                <md-icon>more_vert</md-icon>
            </button>

        </md-toolbar-row>
    </md-toolbar>

    <div class="layer-list" [style.max-height.px] = "height-LayoutService.getToolbarHeightPx()">
        <md-list [dragula]="layer-bag" [dragulaOptions]="dragOptions"
                 *ngIf="layoutService.getLayerListVisibilityStream() | async">

            <md-list-item *ngIf="(layerService.getLayersStream() | async).length === 0">
                <button md-button class="no-layer"
                        (click)="layoutService.setSidenavContentComponent(SourceOperatorListComponent)"
                        mdTooltip="Add New Data" mdTooltipPosition="after"
                >
                    <md-icon>add</md-icon> add a first layer
                </button>
            </md-list-item>

            <template ngFor let-layer [ngForOf]="layerService.getLayersStream() | async">
                <md-list-item
                              [class.active-layer]="layer === (layerService.getSelectedLayerStream() | async)"
                              [class.list-item-extended]="layer.expanded || layer.editSymbology"
                              [title]="layer.name"

                >
                    <md-menu #layerMenu="mdMenu">
                        <!--
                        <button md-menu-item [disabled]="true">
                            <md-icon >visibility_off</md-icon>
                            <span>Hide Layer</span>
                        </button>
                        <button md-menu-item *ngIf="layer.expanded" [disabled]="true">
                            <md-icon >visibility</md-icon>
                            <span>Show Layer</span>
                        </button>
                        -->
                        <button md-menu-item *ngIf="!layer.expanded" (click)="toggleLayer(layer)">
                            <md-icon >expand_more</md-icon>
                            <span>Show Legend</span>
                        </button>
                        <button md-menu-item *ngIf="layer.expanded" (click)="toggleLayer(layer)">
                            <md-icon >expand_less</md-icon>
                            <span>Hide Legend</span>
                        </button>
                        <button md-menu-item (click)="dialog.open(LineageGraphComponent, {layer: layer})">
                            <md-icon>merge_type</md-icon>
                            <span>Lineage</span>
                        </button>
                        <button md-menu-item (click)="layerService.removeLayer(layer)">
                            <md-icon>delete</md-icon>
                            <span>Remove</span>
                        </button>
                        <button md-menu-item (click)="dialog.open(RenameLayerComponent)">
                            <md-icon>mode_edit</md-icon>
                            <span>Rename</span>
                        </button>
                        <button md-menu-item (click)="layerService.toggleEditSymbology(layer)">
                            <md-icon>color_lens</md-icon>
                            <span>Edit Symbology</span>
                        </button>
                        <button md-menu-item (click)="mapService.zoomToLayer(layer)">
                            <md-icon>fullscreen</md-icon>
                            <span>Zoom to Extent</span>
                        </button>
                        <button md-menu-item (click)="dialog.open(LayerExportComponent, {layer: layer})">
                            <md-icon>file_download</md-icon>
                            <span>Export</span>
                        </button>
                    </md-menu>

                    <div class="list-element-inner-container" fxLayout="column" fxLayoutAlign="space-between none">
                        <div fxLayout="row" fxLayoutAlign="space-between center" >

                            <button md-icon-button class="mat-warn error-button" aria-label="Reload"
                                    *ngIf="(layer.loadingState| async) === LoadingState.ERROR"
                                    (click)="layer.reload()"
                            >
                                <md-icon>replay</md-icon>
                            </button>

                            <button md-icon-button
                                *ngIf="(layer.loadingState| async) !== LoadingState.ERROR"
                                aria-label="Show Legend"
                                (click)="toggleLayer(layer)">

                                <template [ngIf]="layer.expanded">
                                    <md-icon md-list-icon >expand_less</md-icon>
                                </template>

                                <template [ngIf]="!layer.expanded">
                                    <template [ngIf]="layer.symbology.getSymbologyType() === ST.CLUSTERED_POINT
                                        || layer.symbology.getSymbologyType() === ST.SIMPLE_POINT">
                                        <md-icon md-list-icon svgIcon="symbology:point"
                                                 [style.stroke-width.px]='2'
                                                 [style.stroke]='layer.symbology.strokeRGBA | rgbaToCssStringPipe'
                                                 [style.fill]='layer.symbology.fillRGBA | rgbaToCssStringPipe'
                                        ></md-icon>
                                    </template>
                                    <template [ngIf]="false">
                                        <md-icon md-list-icon svgIcon="symbology:line"></md-icon>
                                    </template>
                                    <template [ngIf]="layer.symbology.getSymbologyType() === ST.SIMPLE_VECTOR">
                                        <md-icon md-list-icon svgIcon="symbology:polygon"
                                                 [style.stroke-width.px]='2'
                                                 [style.stroke]='layer.symbology.strokeRGBA | rgbaToCssStringPipe'
                                                 [style.fill]='layer.symbology.fillRGBA | rgbaToCssStringPipe'
                                        ></md-icon>
                                    </template>
                                    <template [ngIf]="layer.symbology.getSymbologyType() === ST.MAPPING_COLORIZER_RASTER
                                        || layer.symbology.getSymbologyType() === ST.RASTER">
                                        <md-icon md-list-icon>
                                            <wave-raster-icon [colorizer]="layer.symbology.colorizer$ | async" [xCells]="6" [yCells]="6">
                                            </wave-raster-icon>
                                        </md-icon>
                                    </template>
                                </template>
                            </button>


                            <div #layerName
                                 class="mat-list-item-text grabbable"
                                 fxFlex="grow"
                                 (click)="layerService.setSelectedLayer(layer)">
                                {{layer.name}}
                            </div>

                            <button md-icon-button class="secondary_action"
                                    #menuTrigger [mdMenuTriggerFor]="layerMenu" aria-label="More">
                                <md-icon>more_vert</md-icon>
                            </button>
                        </div>

                        <div *ngIf="layer.expanded" [ngSwitch]="layer.symbology.getSymbologyType()" class="legendary">
                            <template [ngSwitchCase]="ST.SIMPLE_POINT">
                                <wave-legendary-points [symbology]="layer.symbology"></wave-legendary-points>
                            </template>

                            <template [ngSwitchCase]="ST.CLUSTERED_POINT">
                                <wave-legendary-clustered-points [symbology]="layer.symbology">
                                </wave-legendary-clustered-points>
                            </template>

                            <template [ngSwitchCase]="ST.SIMPLE_VECTOR">
                                <wave-legendary-vector [symbology]="layer.symbology"></wave-legendary-vector>
                            </template>

                            <template [ngSwitchCase]="ST.RASTER">
                                <wave-legendary-raster [symbology]="layer.symbology"></wave-legendary-raster>
                            </template>

                            <template [ngSwitchCase]="ST.MAPPING_COLORIZER_RASTER">
                                <wave-legendary-mapping-colorizer-raster [symbology]="layer.symbology">
                                </wave-legendary-mapping-colorizer-raster>
                            </template>

                            <wave-legendary *ngSwitchDefault [symbology]="layer.symbology"></wave-legendary>
                        </div>

                        <div *ngIf="layer.editSymbology" [ngSwitch]="layer.symbology.getSymbologyType()"
                             class="symbology no-drag">

                            <div class="small" fxLayout="row" fxLayoutAlign="space-between center">
                                <span>Edit Symbology</span>
                                <button md-icon-button (click)="layerService.toggleEditSymbology(layer)">
                                    <md-icon>close</md-icon>
                                </button>
                            </div>

                            <template [ngSwitchCase]="ST.SIMPLE_POINT">
                                <wave-symbology-points [symbology]="layer.symbology"></wave-symbology-points>
                            </template>

                            <template [ngSwitchCase]="ST.CLUSTERED_POINT">
                                <wave-symbology-points
                                    class="no-drag" [symbology]="layer.symbology" [editRadius]="false">
                                </wave-symbology-points>
                            </template>

                            <template [ngSwitchCase]="ST.SIMPLE_VECTOR">
                                <wave-symbology-vector [symbology]="layer.symbology"></wave-symbology-vector>
                            </template>

                            <template [ngSwitchCase]="ST.RASTER">
                                <wave-symbology-raster></wave-symbology-raster>
                            </template>

                            <template [ngSwitchCase]="ST.MAPPING_COLORIZER_RASTER">
                                <wave-symbology-raster></wave-symbology-raster>
                            </template>
                        </div>

                        <md-progress-bar
                            [mode]="(layer.loadingState | async) === LoadingState.LOADING ? 'query' : 'determinate'"
                            [value]="100"
                            [color]="(layerService.getSelectedLayerStream() | async) === layer ? 'accent' : ''"
                        ></md-progress-bar>

                    </div>
                </md-list-item>

            </template>
        </md-list>
    </div>

</div>
