<md-menu #projectionMenu="mdMenu">
    <button *ngFor="let p of projections" (click)="model.spatialRefSys = p">{{p}}</button>
</md-menu>
<md-menu #xColMenu="mdMenu">
    <button *ngFor="let i of range(0,model.header.length)" (click)="model.xCol = i">{{i}} - {{model.header[i]}}</button>
</md-menu>
<md-menu #yColMenu="mdMenu">
    <button *ngFor="let i of range(0,model.header.length)" (click)="model.yCol = i">{{i}} - {{model.header[i]}}</button>
</md-menu>


<form (change)="update(false)">
    <md-input-container class="layer">
        <input mdInput id="layerName" [(ngModel)]="model.layerName" name="layerName" placeholder="File Name"
               type="input">
    </md-input-container>

    <fieldset class="frame">
        <legend>{{dialogTitle}}</legend>
        <!-- First page -->

        <div class="form-group" *ngIf="isDataProperties$ | async">

            <div class="group-container">
                <div class="dataProperties">
                    <table class="selector">
                        <tr>
                            <td>
                                Delimitter/Seperator:
                            </td>
                            <td>
                                <md-select name="delimitter" id="delimitter" (change)="update(true)"
                                           [(ngModel)]="model.delimitter">
                                    <md-option *ngFor="let del of delimitters" [value]="del.value">
                                        {{del.def}}
                                    </md-option>
                                </md-select>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Text qualifier:
                            </td>
                            <td>
                                <table cellspacing="0" cellpadding="0" style="border-spacing:0px;">
                                    <tr>
                                        <td>
                                            <md-slide-toggle [(ngModel)]="model.isTextQualifier" id="isTextQualifier"
                                                             name="isTextQualifier" (change)="update(true); resize();">
                                            </md-slide-toggle>
                                        </td>
                                        <td style="padding: 0px;">
                                            <md-select name="texqual" id="texqual" (change)="update(true)"
                                                       [(ngModel)]="model.textQualifier"
                                                       [disabled]="!model.isTextQualifier">
                                                <md-option *ngFor="let tq of texqual" [value]="tq">
                                                    {{tq}}
                                                </md-option>
                                            </md-select>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </table>

                    <table class="selector">
                        <tr>
                            <td>
                                Decimal seperator:
                            </td>
                            <td>
                                <md-select name="decsep" id="decsep" (change)="update(false)"
                                           [(ngModel)]="model.decimalSeperator">
                                    <md-option *ngFor="let ds of decsep" [value]="ds">
                                        <!-- TODO: Disable Comma, if comma is already used for delimiting purposes -->
                                        {{ds}}
                                    </md-option>
                                </md-select>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Header row:
                            </td>
                            <td>
                                <table cellspacing="0" cellpadding="0">
                                    <tr>
                                        <td>
                                            <md-slide-toggle [checked]="model.isHeaderRow" id="isHeaderRow"
                                                             name="isHeaderRow" (change)="changeHeaderMode($event);">
                                            </md-slide-toggle>
                                        </td>
                                        <td style="padding: 0px;">
                                            <input type="number" min="0" value="0" [(ngModel)]="model.headerRow"
                                                   name="headerRowC" id="headerRowC" [disabled]="!model.isHeaderRow"
                                                   (change)="update(true)"
                                            ><!-- TODO: Need to add line count, so you cant expire. -->
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <!-- Second page -->

        <div class="form-group" *ngIf="isSpatialProperties$ | async">
            <div class="group-container">
                <div class="spatialProperties">
                    <div class="longitudeSelector">
                        <strong>X coordinate column:</strong>
                        <md-select name="xCoord" id="xCoord" (change)="update(false)" [(ngModel)]="model.xCol">
                            <template ngFor let-i [ngForOf]="range(0,model.header.length)">
                                <md-option [disabled]="i === (yColumn$ | async)" [value]="i">
                                    <template [ngIf]="model.header[i] !== ''">
                                        {{(i+1) + ' - ' + model.header[i]}}
                                    </template>
                                    <template [ngIf]="model.header[i] === ''">
                                        {{(i+1) + ' - unnamed'}}
                                    </template>
                                </md-option>
                            </template>
                        </md-select>
                        <span class="caption">Longitude</span>
                        <span class="caption">Easting</span>
                    </div>

                    <div class="latitudeSelector">
                        <strong>Y coordinate column:</strong>
                        <md-select name="yCoord" id="yCoord" (change)="update(false)" [(ngModel)]="model.yCol">
                            <template ngFor let-i [ngForOf]="range(0,model.header.length)">
                                <md-option [disabled]="i === (xColumn$ | async)" [value]="i">
                                    <template [ngIf]="model.header[i] !== ''">
                                        {{(i+1) + ' - ' + model.header[i]}}
                                    </template>
                                    <template [ngIf]="model.header[i] === ''">
                                        {{(i+1) + ' - unnamed'}}
                                    </template>
                                </md-option>
                            </template>
                        </md-select>
                        <span class="caption">Latitude</span>
                        <span class="caption">Northing</span>
                    </div>

                    <div class="projectionSelector">
                        <table style="width:100%;">
                            <tr>
                                <td>
                                    <strong>Spatial Reference System:</strong>
                                </td>
                                <td>
                                    <md-select name="spatialRefSys" id="spatialRefSys" (change)="update(false)"
                                               [(ngModel)]="model.spatialRefSys">
                                        <md-option *ngFor="let projection of Projections.ALL_PROJECTIONS"
                                                   [value]="projection">
                                            {{projection}}
                                        </md-option>
                                    </md-select>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Coordinate Format:
                                </td>
                                <td>
                                    <md-select style="align: right;" name="coordForm" id="coordForm"
                                               (change)="update(false)" [(ngModel)]="model.coordForm">
                                        <md-option *ngFor="let i of range(0,coordFormats.length)"
                                                   [value]="coordFormats[i]">
                                            {{coordFormats[i]}}
                                        </md-option>
                                    </md-select>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>


        <!-- Third page -->
        <div class="form-group" *ngIf="isTemporalProperties$ | async">
            <div class="group-container">
                <div class="temporalProperties">
                    <div class="elementGroup">
                        <strong>Interval Type</strong>
                        <md-select
                            (change)="update(false)"
                            [(ngModel)]="model.intervalType" [ngModelOptions]="{standalone: true}"
                        >
                            <md-option *ngFor="let intervalType of intervalTypes" [value]="intervalType.value">
                                {{intervalType.display}}
                            </md-option>
                        </md-select>
                    </div>
                    <div class="elementGroup">
                        <table style="width: 100%;">
                            <tr class="startSelector">
                                <td>
                                    <strong>Start Column</strong>
                                </td>
                                <td>
                                    <md-select name="startCol" id="startCol" (change)="update(false)"
                                               [(ngModel)]="model.startCol"
                                               [disabled]="model.intervalType.indexOf('start') < 0">
                                        <template ngFor let-i [ngForOf]="range(0,model.header.length)">
                                            <md-option
                                                [disabled]="(model.intervalType.indexOf('end') >= 0 || model.intervalType.indexOf('duration') >= 0) && i === (yColumn$ | async)"
                                                [value]="i">
                                                <template [ngIf]="model.header[i] !== ''">
                                                    {{(i+1) + ' - ' + model.header[i]}}
                                                </template>
                                                <template [ngIf]="model.header[i] === ''">
                                                    {{(i+1) + ' - unnamed'}}
                                                </template>
                                            </md-option>
                                        </template>
                                    </md-select>
                                </td>
                            </tr>
                            <tr class="endSelector">
                                <td>
                                    <strong>End/Duration Column</strong>
                                </td>
                                <td>
                                    <md-select name="endCol" id="0" (change)="update(false)" [(ngModel)]="model.endCol"
                                               [disabled]="!(model.intervalType.indexOf('end') >= 0 || model.intervalType.indexOf('duration') >= 0)">
                                        <template ngFor let-i [ngForOf]="range(0,model.header.length)">
                                            <md-option
                                                [disabled]="model.intervalType.indexOf('start') >= 0 && i === (xColumn$ | async)"
                                                [value]="i">
                                                <template [ngIf]="model.header[i] !== ''">
                                                    {{(i+1) + ' - ' + model.header[i]}}
                                                </template>
                                                <template [ngIf]="model.header[i] === ''">
                                                    {{(i+1) + ' - unnamed'}}
                                                </template>
                                            </md-option>
                                        </template>
                                    </md-select>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <div class="elementGroup">
                        <table>
                            <tr class="startSelector">
                                <td>
                                    <i>Start Format</i>
                                </td>
                                <td>
                                    <md-select
                                        (change)="update(false)"
                                        [(ngModel)]="model.startFormat" [ngModelOptions]="{standalone: true}"
                                        [disabled]="model.intervalType === 'none'"
                                    >
                                        <md-option *ngFor="let timeFormat of timeFormats" [value]="timeFormat.value">
                                            {{timeFormat.display}}
                                        </md-option>
                                    </md-select>
                                </td>
                            </tr>
                            <tr class="endSelector">
                                <td>
                                    <i>End/Duration Format</i>
                                </td>
                                <td>
                                    <md-select
                                        (change)="update(false)"
                                        [(ngModel)]="model.endFormat" [ngModelOptions]="{standalone: true}"
                                        [disabled]="model.intervalType === 'none'
                                                    || !(model.intervalType.indexOf('end') >= 0
                                                    || model.intervalType.indexOf('duration') >= 0)"
                                    >
                                        <template [ngIf]="model.intervalType.indexOf('duration') < 0">
                                            <md-option *ngFor="let timeFormat of timeFormats" [value]="timeFormat.value">
                                                {{timeFormat.display}}
                                            </md-option>
                                        </template>
                                        <template [ngIf]="model.intervalType.indexOf('duration') >= 0">
                                            <md-option *ngFor="let durationFormat of durationFormats" [value]="durationFormat.value">
                                                {{durationFormat.display}}
                                            </md-option>
                                        </template>
                                    </md-select>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Table -->

        <div id="table-frame" class="table-frame" style="width:500px;" (window:resize)="resizeTableFrame()">
            <div id="typingdiv" class="typingdiv" *ngIf="(isTypingProperties$ | async)">
                <table class="resizeTable" cellspacing="0" cellpadding="0">
                    <tr>
                        <template ngFor let-i [ngForOf]="range(0,model.header.length)">
                            <td class="custom" style="margin-left:0; margin-right:0; padding-bottom: 3px;">
                                <md-select placeholder="Type" style="width: 100%; margin-top: 15px;" id="isNumber_{{i}}"
                                           name="isNumber_{{i}}" *ngIf="typedCols.indexOf(i) < 0" [(ngModel)]="model.isNumberArr[i]">
                                    <md-option [value]="true">
                                        Number
                                    </md-option>
                                    <md-option [value]="false">
                                        Text
                                    </md-option>
                                </md-select>
                                <p *ngIf="i === model.xCol" class="coordinate_orange">
                                    Coordinate
                                </p>
                                <p *ngIf="i === model.yCol" class="coordinate_blue">
                                    Coordinate
                                </p>
                                <p *ngIf="(i === model.startCol) && model.intervalType.indexOf('start') >= 0" class="time_green">
                                    Time
                                </p>
                                <p class="time_violet"
                                   *ngIf="(i === model.endCol) && (model.intervalType.indexOf('duration') >= 0 || model.intervalType.indexOf('end') >= 0)">
                                    Time
                                </p>
                            </td>
                            <td *ngIf="i !== model.header.length-1" name="spacer"></td>
                        </template>
                    </tr>
                </table>
            </div>
            <div id="headerdiv" class="headerdiv">
                <table class="resizeTable" cellspacing="0" cellpadding="0">
                    <tr>
                        <!-- header goes here -->
                        <template [ngIf]="model.isHeaderRow">
                            <template ngFor let-i [ngForOf]="range(0,model.header.length)">
                                <td style="margin-left:0; margin-right:0; padding-bottom: 3px;" title="{{model.header[i]}}"
                                    [ngClass]="{'orangeHead': (isSpatialProperties$ | async) && (i === (xColumn$ | async)), 'blueHead': (isSpatialProperties$ | async) && (i === (yColumn$ | async)), 'greenHead': (isTemporalProperties$ |async) && (i === (xColumn$ | async)) && model.intervalType.indexOf('start') >= 0, 'violetHead': (isTemporalProperties$ | async) && (i === (yColumn$ | async)) && (model.intervalType.indexOf('duration') >= 0 || model.intervalType.indexOf('end') >= 0)}">
                                    {{model.header[i]}}
                                </td>
                                <td *ngIf="i !== model.header.length-1" name="spacer"></td>
                            </template>
                        </template>
                        <template [ngIf]="!model.isHeaderRow">
                            <template ngFor let-i [ngForOf]="range(0,model.header.length)">
                                <td class="custom" style="margin-left:0; margin-right:0;"
                                    [ngClass]="{orangeHead: (isSpatialProperties$ | async) && (i === (xColumn$ | async)), blueHead: (isSpatialProperties$ | async) && (i === (yColumn$ | async)), greenHead: (isTemporalProperties$ |async) && (i === (xColumn$ | async)) && model.intervalType.indexOf('start') >= 0, violetHead: (isTemporalProperties$ | async) && (i === (yColumn$ | async)) && (model.intervalType.indexOf('duration') >= 0 || model.intervalType.indexOf('end') >= 0)}">
                                    <md-input-container>
                                        <input mdInput type="text" placeholder="{{i+1}}{{ending(i+1)}} Column"
                                               [(ngModel)]="model.header[i]" name="header_{{i}}">
                                    </md-input-container>
                                </td>
                                <td *ngIf="i !== model.header.length-1" name="spacer"></td>
                            </template>
                        </template>
                    </tr>
                </table>
            </div>
            <div id="bodydiv" class="bodydiv"
                 (scroll)="bodyScroll()">
                <table class="resizeTable" cellspacing="0" cellpadding="0">
                    <!-- body goes here -->
                    <tr *ngFor="let i of range(0,elements.length)" style="white-space: nowrap;">
                        <template ngFor let-j [ngForOf]="range(0,model.header.length)">
                            <td style="margin-left:0; margin-right:0;"
                                [ngClass]="{orange: (isSpatialProperties$ | async) && (j === (xColumn$ | async)), blue: (isSpatialProperties$ | async) && (j === (yColumn$ | async)), green: (isTemporalProperties$ |async) && (j === (xColumn$ | async)) && model.intervalType.indexOf('start') >= 0, violet: (isTemporalProperties$ | async) && (j === (yColumn$ | async)) && (model.intervalType.indexOf('duration') >= 0 || model.intervalType.indexOf('end') >= 0)}">
                                {{elements[i][j]}}
                            </td>
                            <td *ngIf="j !== model.header.length-1" name="spacer"></td>
                        </template>
                    </tr>
                </table>
            </div>
        </div>

    </fieldset>
    <!-- Buttons -->

    <md-dialog-actions align="end">
        <div class="buttons">
            <span *ngIf="(isSpatialProperties$ | async) || (isTemporalProperties$ | async) || (isTypingProperties$ | async)">
              <button md-raised-button (click)="prev()">Prev</button>
            </span>
            <span *ngIf="(isSpatialProperties$ | async) || (isDataProperties$ | async) || (isTemporalProperties$ | async)">
                <button md-raised-button color="primary" (click)="next()"
                        [disabled]="(((isSpatialProperties$ | async) && (xColumn$ | async) === (yColumn$ | async))
                                    || ((isTemporalProperties$ | async) && (((xColumn$ | async) === (yColumn$ | async))
                                    && ((model.intervalType.indexOf('end') >= 0 || model.intervalType.indexOf('duration') >= 0)
                                    && model.intervalType.indexOf('start') >= 0))) && model.header.length > 1)"
                >
                    Next
                </button>
            </span>
            <button md-raised-button color="primary" (click)="submit()" *ngIf="isTypingProperties$ | async"
                    [disabled]="(xColumn$ | async) === (yColumn$ | async)
                                && ((model.intervalType.indexOf('end') >= 0 || model.intervalType.indexOf('duration') >= 0)
                                && model.intervalType.indexOf('start') >= 0)"
            >
                Submit
            </button>
        </div>
    </md-dialog-actions>
</form>
